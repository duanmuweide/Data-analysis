# 项目数据字典

## 1. Hive表数据字典

### 1.1 外部表：crime_incidents_external

| 字段名 | 数据类型 | 描述 | 示例值 | 是否允许为空 |
|-------|---------|------|-------|------------|
| incident_id | STRING | 事件唯一标识符 | 1234567 | 否 |
| offence_code | STRING | 犯罪行为代码 | 01A | 是 |
| cr_number | STRING | 犯罪报告编号 | CR-2023-001234 | 是 |
| dispatch_time | TIMESTAMP | 调度日期和时间 | 2023-12-09 14:30:00 | 是 |
| start_time | TIMESTAMP | 事件开始日期和时间 | 2023-12-09 14:25:00 | 是 |
| end_time | TIMESTAMP | 事件结束日期和时间 | 2023-12-09 14:35:00 | 是 |
| nibrs_code | STRING | 国家基于事件报告系统代码 | 011 | 是 |
| victims | INT | 受害者数量 | 1 | 是 |
| crime_name1 | STRING | 主要犯罪类型名称 | LARCENY-THEFT | 是 |
| crime_name2 | STRING | 次要犯罪类型名称 | SHOPLIFTING | 是 |
| crime_name3 | STRING | 第三犯罪类型名称 | - | 是 |
| police_district | STRING | 警察管辖区 | CENTRAL | 是 |
| block_address | STRING | 街区地址 | 100-199 MAIN ST | 是 |
| city | STRING | 城市 | BALTIMORE | 否（默认：UNKNOWN） |
| state | STRING | 州 | MD | 否（默认：MD） |
| zip_code | STRING | 邮政编码 | 21201 | 是 |
| agency | STRING | 执法机构 | BPD | 是 |
| place | STRING | 发生地点类型 | STREET | 是 |
| sector | STRING | 警区扇形区域 | A | 是 |
| beat | STRING | 巡逻区域 | 123 | 是 |
| pra | STRING | 人口普查区域 | 1234 | 是 |
| address_num | STRING | 门牌号 | 123 | 是 |
| street_prefix | STRING | 街道前缀 | N | 是 |
| street_name | STRING | 街道名称 | MAIN | 是 |
| street_suffix | STRING | 街道后缀 | ST | 是 |
| street_type | STRING | 街道类型 | AVE | 是 |
| latitude | DOUBLE | 纬度坐标 | 39.2904 | 是 |
| longitude | DOUBLE | 经度坐标 | -76.6122 | 是 |
| district_num | STRING | 地区编号 | 1 | 是 |
| location | STRING | 完整位置描述 | 123 MAIN ST, BALTIMORE, MD | 是 |
| year | INT | 分区字段：年份 | 2023 | 否 |
| month | INT | 分区字段：月份 | 12 | 否 |
| day | INT | 分区字段：日期 | 9 | 否 |

### 1.2 内部表：crime_incidents

与外部表结构相同，但存储格式为ORC，并且按city字段分桶（8个桶），用于提高查询性能。

## 2. HBase表数据字典

### 2.1 表名：crime_data_hbase

| 列族 | 字段名 | 数据类型 | 描述 | 示例值 |
|-----|-------|---------|------|-------|
| incident | incident_id | STRING | 事件唯一标识符 | 1234567 |
| incident | offence_code | STRING | 犯罪行为代码 | 01A |
| incident | cr_number | STRING | 犯罪报告编号 | CR-2023-001234 |
| incident | nibrs_code | STRING | 国家基于事件报告系统代码 | 011 |
| incident | victims | INT | 受害者数量 | 1 |
| incident | crime_name1 | STRING | 主要犯罪类型名称 | LARCENY-THEFT |
| incident | crime_name2 | STRING | 次要犯罪类型名称 | SHOPLIFTING |
| incident | crime_name3 | STRING | 第三犯罪类型名称 | - |
| time | dispatch_time | STRING | 调度日期和时间 | 2023-12-09 14:30:00 |
| time | start_time | STRING | 事件开始日期和时间 | 2023-12-09 14:25:00 |
| time | end_time | STRING | 事件结束日期和时间 | 2023-12-09 14:35:00 |
| location | block_address | STRING | 街区地址 | 100-199 MAIN ST |
| location | city | STRING | 城市 | BALTIMORE |
| location | state | STRING | 州 | MD |
| location | zip_code | STRING | 邮政编码 | 21201 |
| location | latitude | STRING | 纬度坐标 | 39.2904 |
| location | longitude | STRING | 经度坐标 | -76.6122 |
| location | address_num | STRING | 门牌号 | 123 |
| location | street_prefix | STRING | 街道前缀 | N |
| location | street_name | STRING | 街道名称 | MAIN |
| location | street_suffix | STRING | 街道后缀 | ST |
| location | street_type | STRING | 街道类型 | AVE |
| police | police_district | STRING | 警察管辖区 | CENTRAL |
| police | agency | STRING | 执法机构 | BPD |
| police | place | STRING | 发生地点类型 | STREET |
| police | sector | STRING | 警区扇形区域 | A |
| police | beat | STRING | 巡逻区域 | 123 |
| police | pra | STRING | 人口普查区域 | 1234 |
| police | district_num | STRING | 地区编号 | 1 |

### 2.2 RowKey设计

RowKey格式：`city:year-month-day:incident_id`

示例：`BALTIMORE:2023-12-09:1234567`

**设计说明**：
1. **city**：城市作为前缀，可以按城市快速查询和统计
2. **year-month-day**：时间戳，便于按时间范围查询
3. **incident_id**：事件唯一ID，确保RowKey的唯一性

**避免数据热点和倾斜的策略**：
- 使用城市作为前缀，将数据分散到不同的Region
- 时间部分使用年-月-日格式，避免单调递增的时间戳导致的数据热点
- 事件ID确保了即使在同一城市同一时间的多个事件也能有唯一的RowKey